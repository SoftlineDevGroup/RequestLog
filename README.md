# Решение «Журнал запросов»

## Описание
Решение позволяет:
 - ставить в очередь на передачу исходящих запросов из системы Directum RX в любую другую систему, отправлять сообщения из очереди
 - обеспечивает гарантированную доставку: сообщение будет отправляться до тех пор, пока не будет отправлено, доставлено, либо закончатся попытки отправки.
 - фиксировать входящие запросы к реализованным методам интеграции, успешно прошедшие валидацию сервиса интеграции.
 - содержит набор методов для синхронизации организационно-штатной структуры и контрагентов.

## Состав объектов разработки
 - Справочники «Запрос» (BaseRequest, абстрактный), «Входящий запрос» (IncRequest), «Исходящий запрос» (OutRequest), «Подключение к внешним системам» (ExternalConnection), «Метод сторонней системы» (ExternalMethod), справочник для хранения тяжелых тел запросов (LargeBody)
 - Роль «Ответственные за интеграцию» с полным доступом к справочникам модуля.
 - Фоновые процесс «Интеграция. Отправка запросов» (SendingRequest), фоновый процесс «Интеграция. Очистка старых запросов» (DeleteOldRequest), асинхронный обработчик для пакетной отправки запросов (AsyncSendRequests).

## Варианты расширения функциональности на проектах
1.	Добавить новый справочник, соответствия типов/видов документов – по справочнику соответствий автоматически выбирать нужную систему (или системы) для отправки документа.
2.	Любую функцию решения можно переопределить, каждый из методов помечен как virtual, что позволяет менять как всю логику, так и вносить точечные изменения.
3.	Для изменения синхронизации ОШС предусмотрено расширение в структурах методов (свойство ObjectExtension), что позволяет передать в существующие структуры дополнительную информацию, и после, перекрывая соответствующий метод – добавить свою обработку. 
4.	Решение обладает рядом настроек, все настройки хранятся в базе данных, в таблице параметров. Администратор, либо участник интеграционной роли может провести нужную настройку модуля, в зависимости от потребностей на том или ином проекте.

## Архитектурно неочевидные моменты
1.	Для работы решения в части отправки запросов в сторонние системы, необходимо создать «Подключение к внешней системе». Справочник «Метод сторонней системы» является опциональным. 
2.	Поиск записей вышеуказанных справочников рекомендуется по Коду (уникальное значение) обоих справочников, что исключает проблему с разными идентификаторами на разных контурах.
3.	При отправке во множество систем, рекомендуется обновлять запись исходящего запроса интеграционным методом, фиксирующем статус получения и(или) доставки в ту, или иную систему-приемник (при наличии такой возможности у системы-приемника).

Решение не содержит перекрытий объектов коробочного решения, это позволяет использовать его, как при старте нового проекта, так и в ходе сопровождения существующих инсталляций системы.

## Порядок установки
Для работы требуется установленный Directum RX версии 4.9 и выше.

### Установка для ознакомления
1. Склонировать репозиторий RequestLog в папку.
2. Указать в _ConfigSettings.xml DDS:
   ```xml
   <block name="REPOSITORIES">
     <repository folderName="Base" solutionType="Base" url="" />
     <repository folderName="RX" solutionType="Base" url="<адрес локального репозитория>" />
     <repository folderName="<Папка из п.1>" solutionType="Work" 
       url="" />
   </block>
   ```

### Установка для использования на проекте
Возможные варианты:

**A. Fork репозитория**

1. Сделать fork репозитория rx-template-integrationsettings для своей учетной записи.
2. Склонировать созданный в п. 1 репозиторий в папку.
3. Указать в _ConfigSettings.xml DDS:
   ``` xml
   <block name="REPOSITORIES">
     <repository folderName="Base" solutionType="Base" url="" />
     <repository folderName="<Папка из п.2>" solutionType="Work"
       url="<Адрес репозитория gitHub учетной записи пользователя из п. 1>" />
   </block>
   ```

**B. Подключение на базовый слой.**

Вариант не рекомендуется, так как при выходе версии шаблона разработки не гарантируется обратная совместимость.
1. Склонировать репозиторий RequestLog в папку.
2. Указать в _ConfigSettings.xml DDS:
   ``` xml
   <block name="REPOSITORIES">
     <repository folderName="Base" solutionType="Base" url="" />
     <repository folderName="<Папка из п.1>" solutionType="Base"
       url="" />
     <repository folderName="<Папка для рабочего слоя>" solutionType="Work"
       url="<Адрес репозитория gitHub>" />
   </block>
   ```

**C. Копирование репозитория в систему контроля версий.**

Рекомендуемый вариант для проектов внедрения.
1. В системе контроля версий с поддержкой git создать новый репозиторий.
2. Склонировать репозиторий RequestLog в папку с ключом `--mirror`.
3. Перейти в папку из п. 2.
4. Импортировать клонированный репозиторий в систему контроля версий командой: \
   `git push –mirror <Адрес репозитория из п. 1>`
